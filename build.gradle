description = "Ceylon Dart Backend"

allprojects {
    group = 'com.vasileff.ceylon.dart'
    version = '0.0.1'
}

// root project

apply plugin: 'base'

ext.ceylonRepoDir = System.getProperty("user.home") + "/.ceylon/repo"
ext.ceylonBinDir = System.getProperty("user.home") + "/.ceylon/bin"

task build(dependsOn: assemble) {
    group = 'Build'
    description = 'Assembles and tests this project.'
}

// ceylon-dart-compiler

project('ceylon-dart-compiler') {
    description = "Ceylon Dart Backend Compiler"
    apply plugin: 'ceylon'

    defaultTasks 'compileCeylon'

    compileCeylon {
        // standard is src/main/ceylon
        sourceDir file("source")
    }

    ceylonDoc {
        includeSource true
        includeNonShared true
        ignoreMissingDoc true
        ignoreMissingThrows true
    }

    task ceylonTest(type: CeylonTestTask) {
        dependsOn compileCeylon

        report = true
        module "com.vasileff.ceylon.dart"
        test "com.vasileff.ceylon.dart.test"
    }

    task install(type: Copy) {
        dependsOn "publish"
        from(projectDir) {
          include "ceylon-compile-dart.plugin"
          include "ceylon-run-dart.plugin"
        }
        into ceylonBinDir
    }

    task publish(type: Copy) {
        description 'Copies the compiled modules to the user\'s repository'

        dependsOn "ceylonDoc"
        dependsOn "compileCeylon"

        from ceylonDoc.destinationDir
        from compileCeylon.destinationDir

        into ceylonRepoDir
    }

    task test {
        dependsOn ceylonTest;
    }

    task build(dependsOn: assemble) {
        dependsOn test;
        group = 'Build'
        description = 'Assembles and tests this project.'
    }
}

wrapper {
    jarFile 'buildSrc/wrapper/gradle-wrapper.jar'
}

